# getCustomExtensionCustomTables

Retrieves all custom tables associated with a specific custom extension from the parent application's local database.

## Parameters

### `GetCustomExtensionCustomTablesParams`

```typescript
interface GetCustomExtensionCustomTablesParams {
    extensionId: string;
}
```

#### `extensionId` (required)

The unique identifier (`_id`) of the custom extension whose associated custom tables you want to retrieve.

## Response

### `GetCustomExtensionCustomTablesResponse`

```typescript
interface GetCustomExtensionCustomTablesResponse {
    success: boolean;
    customTables: CFCustomTable[];
    timestamp: string;
}
```

#### `success` (boolean)

Indicates whether the custom tables were successfully retrieved.

#### `customTables` (CFCustomTable[])

An array of custom table objects associated with the specified extension. Each custom table has the following structure:

```typescript
type CFCustomTable = BaseEntity & {
    name: string;
    description?: string;
    metadata?: Array<{
        key: string;
        value: any;
    }>;
}
```

**Fields:**

- `_id` (string): Unique identifier for the custom table
- `name` (string): The name of the custom table
- `description` (string, optional): A description of the custom table
- `metadata` (Array, optional): Custom metadata as key-value pairs (typically includes `extensionId`)
- `createdAt` (string): Creation timestamp
- `updatedAt` (string): Last update timestamp

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { command } from '@final-commerce/command-frame';
```

## Usage Examples

### Get Tables for an Extension

Retrieve all custom tables for a specific extension:

```typescript
import { command } from '@final-commerce/command-frame';

const result = await command.getCustomExtensionCustomTables({
    extensionId: '65a1b2c3d4e5f6g7h8i9j0k1'
});

console.log('Extension Custom Tables:', result.customTables);
result.customTables.forEach(table => {
    console.log(`Table: ${table.name} (ID: ${table._id})`);
});
```

### List All Extensions and Their Tables

Get all extensions and then retrieve their associated tables:

```typescript
import { command } from '@final-commerce/command-frame';

// Get all extensions
const extensionsResult = await command.getCustomExtensions();

// For each extension, get its tables
for (const extension of extensionsResult.customExtensions) {
    const tablesResult = await command.getCustomExtensionCustomTables({
        extensionId: extension._id
    });
    
    console.log(`Extension: ${extension.label}`);
    console.log(`Tables (${tablesResult.customTables.length}):`);
    
    tablesResult.customTables.forEach(table => {
        console.log(`  - ${table.name}: ${table.description || 'No description'}`);
    });
}
```

### Access Extension Table Data

Get tables for an extension and then retrieve data from them:

```typescript
import { command } from '@final-commerce/command-frame';

const extensionId = '65a1b2c3d4e5f6g7h8i9j0k1';

// Get extension tables
const tablesResult = await command.getCustomExtensionCustomTables({
    extensionId
});

// Access data from each table
for (const table of tablesResult.customTables) {
    const dataResult = await command.getCustomTableData({
        tableName: table.name
    });
    
    console.log(`Table: ${table.name}`);
    console.log(`Records: ${dataResult.data.length}`);
}
```

### Build Extension Dashboard

Create a dashboard showing extension information and its data tables:

```typescript
import { command } from '@final-commerce/command-frame';

async function buildExtensionDashboard(extensionId: string) {
    // Get extension details
    const extensionsResult = await command.getCustomExtensions();
    const extension = extensionsResult.customExtensions.find(
        ext => ext._id === extensionId
    );
    
    if (!extension) {
        console.error('Extension not found');
        return;
    }
    
    // Get extension's tables
    const tablesResult = await command.getCustomExtensionCustomTables({
        extensionId
    });
    
    // Build dashboard
    console.log(`Dashboard for: ${extension.label}`);
    console.log(`Description: ${extension.description}`);
    console.log(`Category: ${extension.category}`);
    console.log(`\nData Tables (${tablesResult.customTables.length}):`);
    
    for (const table of tablesResult.customTables) {
        // Get record count
        const dataResult = await command.getCustomTableData({
            tableName: table.name,
            limit: 0  // Just to get count
        });
        
        console.log(`  ${table.name}: ${dataResult.data.length} records`);
    }
}

buildExtensionDashboard('65a1b2c3d4e5f6g7h8i9j0k1');
```

### Check if Extension Has Tables

Verify if an extension has any associated tables:

```typescript
import { command } from '@final-commerce/command-frame';

const result = await command.getCustomExtensionCustomTables({
    extensionId: '65a1b2c3d4e5f6g7h8i9j0k1'
});

if (result.customTables.length === 0) {
    console.log('This extension has no custom tables');
} else {
    console.log(`This extension has ${result.customTables.length} custom table(s)`);
}
```

## Error Handling

If the retrieval fails, the handler will throw an error. Common error scenarios include:
- Invalid `extensionId` (extension does not exist)
- Database connection issues

## Validation Rules

- `extensionId` is required and must reference an existing custom extension

## Real Data Examples

### Example Response

```json
{
  "success": true,
  "customTables": [
    {
      "_id": "65a1b2c3d4e5f6g7h8i9j0k3",
      "name": "loyalty_points",
      "description": "Track customer loyalty points",
      "metadata": [
        {
          "key": "extensionId",
          "value": "65a1b2c3d4e5f6g7h8i9j0k1"
        },
        {
          "key": "version",
          "value": "1.0"
        }
      ],
      "createdAt": "2024-01-01T10:30:00.000Z",
      "updatedAt": "2024-01-01T10:30:00.000Z"
    },
    {
      "_id": "65a1b2c3d4e5f6g7h8i9j0k4",
      "name": "loyalty_rewards",
      "description": "Available rewards for loyalty program",
      "metadata": [
        {
          "key": "extensionId",
          "value": "65a1b2c3d4e5f6g7h8i9j0k1"
        }
      ],
      "createdAt": "2024-01-01T10:31:00.000Z",
      "updatedAt": "2024-01-05T14:20:00.000Z"
    },
    {
      "_id": "65a1b2c3d4e5f6g7h8i9j0k5",
      "name": "loyalty_transactions",
      "description": "History of loyalty point transactions",
      "metadata": [
        {
          "key": "extensionId",
          "value": "65a1b2c3d4e5f6g7h8i9j0k1"
        }
      ],
      "createdAt": "2024-01-01T10:32:00.000Z",
      "updatedAt": "2024-01-01T10:32:00.000Z"
    }
  ],
  "timestamp": "2024-01-15T12:00:00.000Z"
}
```

### Example Request

```json
{
  "extensionId": "65a1b2c3d4e5f6g7h8i9j0k1"
}
```

## Notes

- Custom tables are stored in the local IndexedDB database (LokiJS)
- Custom tables are synchronized with the central MongoDB database via station-sync
- The metadata typically includes the `extensionId` to link tables to their parent extension
- Use `getCustomTableFields` to retrieve field definitions for any table
- Use `getCustomTableData` to retrieve the actual data stored in a table
- An extension may have zero or multiple associated custom tables
- Tables from different extensions are isolated and managed independently

