# getCustomTableFields

Retrieves the field definitions (schema) for a specific custom table from the parent application's local database.

## Parameters

### `GetCustomTableFieldsParams`

```typescript
interface GetCustomTableFieldsParams {
    tableId: string;
}
```

#### `tableId` (required)

The unique identifier (`_id`) of the custom table whose fields you want to retrieve.

## Response

### `GetCustomTableFieldsResponse`

```typescript
interface GetCustomTableFieldsResponse {
    success: boolean;
    fields: CFCustomTableField[];
    timestamp: string;
}
```

#### `success` (boolean)

Indicates whether the fields were successfully retrieved.

#### `fields` (CFCustomTableField[])

An array of field definition objects. Each field has the following structure:

```typescript
type CFCustomTableField = BaseEntity & {
    tableId: string;
    name: string;
    type: AttributeType;
    required?: boolean;
    defaultValue?: any;
    referenceLinkedCollection?: string;
    referenceLinkedField?: string;
}

enum AttributeType {
    STRING = 'string',
    NUMBER = 'number',
    BOOLEAN = 'boolean',
    DATE = 'date',
    JSON_STRING = 'json-string',
}
```

**Fields:**

- `_id` (string): Unique identifier for the field definition
- `tableId` (string): The ID of the custom table this field belongs to
- `name` (string): The name of the field
- `type` (AttributeType): The data type of the field (string, number, boolean, date, json-string)
- `required` (boolean, optional): Whether this field is required when creating records
- `defaultValue` (any, optional): Default value for the field if not provided
- `referenceLinkedCollection` (string, optional): Name of the collection this field references (for foreign keys)
- `referenceLinkedField` (string, optional): Name of the field in the referenced collection
- `createdAt` (string): Creation timestamp
- `updatedAt` (string): Last update timestamp

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { command } from '@final-commerce/command-frame';
```

## Usage Examples

### Get Fields for a Table

Retrieve field definitions for a specific table:

```typescript
import { command } from '@final-commerce/command-frame';

// First, get the table to find its ID
const tablesResult = await command.getCustomTables();
const table = tablesResult.customTables.find(t => t.name === 'customer_preferences');

// Then get the fields
const result = await command.getCustomTableFields({
    tableId: table._id
});

console.log('Table Fields:', result.fields);
result.fields.forEach(field => {
    console.log(`Field: ${field.name} (Type: ${field.type}, Required: ${field.required || false})`);
});
```

### Validate Data Against Schema

Use field definitions to validate data before upserting:

```typescript
import { command } from '@final-commerce/command-frame';

const tablesResult = await command.getCustomTables();
const table = tablesResult.customTables.find(t => t.name === 'loyalty_points');

const fieldsResult = await command.getCustomTableFields({
    tableId: table._id
});

// Check required fields
const requiredFields = fieldsResult.fields
    .filter(f => f.required)
    .map(f => f.name);

console.log('Required fields:', requiredFields);

// Validate your data object has all required fields
const dataToInsert = {
    customerId: '691df9c6c478bada1fb23d55',
    points: 150
};

const missingFields = requiredFields.filter(field => !(field in dataToInsert));
if (missingFields.length > 0) {
    console.error('Missing required fields:', missingFields);
}
```

### Build Dynamic Forms

Use field definitions to dynamically generate input forms:

```typescript
import { command } from '@final-commerce/command-frame';

const tablesResult = await command.getCustomTables();
const table = tablesResult.customTables.find(t => t.name === 'customer_preferences');

const fieldsResult = await command.getCustomTableFields({
    tableId: table._id
});

// Generate form inputs based on field types
fieldsResult.fields.forEach(field => {
    let inputType;
    switch (field.type) {
        case 'string':
            inputType = 'text';
            break;
        case 'number':
            inputType = 'number';
            break;
        case 'boolean':
            inputType = 'checkbox';
            break;
        case 'date':
            inputType = 'date';
            break;
        case 'json-string':
            inputType = 'textarea';
            break;
    }
    
    console.log(`Create ${inputType} input for ${field.name}`);
});
```

## Error Handling

If the field retrieval fails, the handler will throw an error. Common error scenarios include:
- Invalid `tableId` (table does not exist)
- Database connection issues

## Validation Rules

- `tableId` is required and must reference an existing custom table

## Real Data Examples

### Example Response

```json
{
  "success": true,
  "fields": [
    {
      "_id": "65a1b2c3d4e5f6g7h8i9j0k5",
      "tableId": "65a1b2c3d4e5f6g7h8i9j0k1",
      "name": "customerId",
      "type": "string",
      "required": true,
      "referenceLinkedCollection": "customers",
      "referenceLinkedField": "_id",
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T10:00:00.000Z"
    },
    {
      "_id": "65a1b2c3d4e5f6g7h8i9j0k6",
      "tableId": "65a1b2c3d4e5f6g7h8i9j0k1",
      "name": "theme",
      "type": "string",
      "required": true,
      "defaultValue": "light",
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T10:00:00.000Z"
    },
    {
      "_id": "65a1b2c3d4e5f6g7h8i9j0k7",
      "tableId": "65a1b2c3d4e5f6g7h8i9j0k1",
      "name": "notifications",
      "type": "boolean",
      "required": false,
      "defaultValue": true,
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T10:00:00.000Z"
    },
    {
      "_id": "65a1b2c3d4e5f6g7h8i9j0k8",
      "tableId": "65a1b2c3d4e5f6g7h8i9j0k1",
      "name": "lastLoginDate",
      "type": "date",
      "required": false,
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T10:00:00.000Z"
    }
  ],
  "timestamp": "2024-01-15T12:00:00.000Z"
}
```

### Example Request

```json
{
  "tableId": "65a1b2c3d4e5f6g7h8i9j0k1"
}
```

## Notes

- Field definitions are stored in the local IndexedDB database (LokiJS)
- Field definitions are synchronized with the central MongoDB database via station-sync
- Use `getCustomTables` to list all available tables and get their IDs
- Field types determine how data should be validated and formatted
- Reference fields (`referenceLinkedCollection` and `referenceLinkedField`) define foreign key relationships

