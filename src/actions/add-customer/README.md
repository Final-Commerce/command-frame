# addCustomer

Adds a new customer to the local database in the parent application.

## Parameters

### `AddCustomerParams`

```typescript
interface AddCustomerParams {
    customer: Omit<CFCustomer, '_id' | 'createdAt' | 'updatedAt'>;
}
```

#### `customer` (required)

The customer object to create. It requires all standard customer fields except those generated by the server/database (`_id`, `createdAt`, `updatedAt`).

**Typical customer structure:**

**Required fields:**

- `email` (string): Customer email address. Must be unique and valid.
- `firstName` (string): Customer's first name.
- `lastName` (string): Customer's last name.
- `companyId` (any): Company ID associated with the customer.

**Optional fields:**

- `phone` (string): Customer's phone number.
- `tags` (string[]): Array of tags to associate with the customer.
- `metadata` (Array<{ key: string; value: string }>): Custom metadata as key-value pairs.
- `notes` (Array<{ createdAt: Date | string; message: string }>): Array of notes associated with the customer.
- `billing` (object): Billing address information (see Address Structure below).
- `shipping` (object): Shipping address information (see Address Structure below).
- `externalId` (string): External system identifier.
- `fromOliver` (boolean): Indicates if the customer originated from Oliver system.

### Address Structure

Both `billing` and `shipping` follow the address structure shown in the [Real Data Examples](#real-data-examples) section below.

### Metadata Structure

Metadata is an array of key-value pairs. See the [Real Data Examples](#real-data-examples) section below for actual examples.

### Notes Structure

Notes is an array of timestamped messages. See the [Real Data Examples](#real-data-examples) section below for actual examples.

## Response

### `AddCustomerResponse`

```typescript
interface AddCustomerResponse {
    success: boolean;
    customer: CFCustomer;
    timestamp: string;
}
```

#### `success` (boolean)

Indicates whether the customer was successfully created.

#### `customer` (CFCustomer)

The created customer object, including all fields from the request plus automatically generated fields. The structure is strictly typed as `CFCustomer`.

- `_id`: Unique identifier (MongoDB style).
- `createdAt`: Creation timestamp.
- `updatedAt`: Last update timestamp.

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { command } from '@final-commerce/command-frame';
```

## Usage Examples

### Create Customer

Create a customer with basic information:

```typescript
import { command } from '@final-commerce/command-frame';

const result = await command.addCustomer({
    customer: {
        email: 'newcustomer.test@example.com',
        firstName: 'John',
        lastName: 'Doe',
        phone: '1234567890',
        companyId: 'company_123', // Required
        // ... other fields
    }
});

console.log(result.customer);
```

## Error Handling

If the customer creation fails, the handler will throw an error. Common error scenarios include missing `customer` object, invalid email format, or duplicate email.

## Validation Rules

- `email` is required and must be a valid email format
- `firstName`, `lastName` are required.
- `billing.address1`, `billing.city`, `billing.state`, `billing.country`, and `billing.postCode` are required if `billing` is provided
- `shipping.address1`, `shipping.city`, `shipping.state`, `shipping.country`, and `shipping.postCode` are required if `shipping` is provided
- `metadata` items must have both `key` and `value` as strings
- `notes` items must have both `createdAt` and `message` fields

## Real Data Examples

### Example Response

```json
{
  "success": true,
  "customer": {
    "firstName": "John",
    "lastName": "Doe",
    "email": "newcustomer.test@example.com",
    "phone": "1234567890",
    "companyId": "company_123",
    "_id": "6931e04f53d9113bd5231dfd",
    "createdAt": "2025-12-04T19:26:07.316Z",
    "updatedAt": "2025-12-04T19:26:07.316Z"
  },
  "timestamp": "2025-12-04T19:26:07.316Z"
}
```

### Example Request

```json
{
  "customer": {
    "firstName": "John",
    "lastName": "Doe",
    "email": "newcustomer.test@example.com",
    "phone": "1234567890",
    "companyId": "company_123"
  }
}
```

## Notes

- The customer is created in the local IndexedDB database (LokiJS)
- Generated fields (ID field, `createdAt`, `updatedAt`) are automatically added
- The `fromOliver` field defaults based on the system configuration
- Customer data is synchronized with the central MongoDB database via station-sync
