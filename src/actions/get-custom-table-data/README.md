# getCustomTableData

Retrieves data from a specific custom table in the parent application's local database. Supports filtering, pagination, and MongoDB-style queries.

## Parameters

### `GetCustomTableDataParams`

```typescript
interface GetCustomTableDataParams {
    tableName: string;
    query?: any;
    offset?: number;
    limit?: number;
}
```

#### `tableName` (required)

The name of the custom table to retrieve data from.

#### `query` (optional)

MongoDB-style query object to filter the data. Supports standard MongoDB query operators like `$eq`, `$gt`, `$lt`, `$in`, `$regex`, etc.

**Examples:**
- `{ status: "active" }` - Find all records where status equals "active"
- `{ age: { $gte: 18 } }` - Find all records where age is greater than or equal to 18
- `{ email: { $regex: "@example.com" } }` - Find all records with email containing "@example.com"

#### `offset` (optional)

The number of records to skip. Useful for pagination. Defaults to 0.

#### `limit` (optional)

The maximum number of records to return. Useful for pagination. If not specified, all matching records are returned.

## Response

### `GetCustomTableDataResponse<T>`

```typescript
interface GetCustomTableDataResponse<T = any> {
    success: boolean;
    data: T[];
    timestamp: string;
}
```

#### `success` (boolean)

Indicates whether the data was successfully retrieved.

#### `data` (T[])

An array of data records from the custom table. The structure of each record depends on the table's field definitions. Each record will include:
- `_id` (string): Unique identifier for the record
- Custom fields defined in the table schema
- `createdAt` (string): Creation timestamp
- `updatedAt` (string): Last update timestamp

#### `timestamp` (string)

ISO 8601 timestamp string (e.g., `"2024-01-01T00:00:00.000Z"`) indicating when the response was generated by the handler.

## Usage

```typescript
import { command } from '@final-commerce/command-frame';
```

## Usage Examples

### Get All Data from a Table

Retrieve all records from a custom table:

```typescript
import { command } from '@final-commerce/command-frame';

const result = await command.getCustomTableData({
    tableName: 'customer_preferences'
});

console.log('All Records:', result.data);
```

### Get Data with Filtering

Retrieve records that match specific criteria:

```typescript
import { command } from '@final-commerce/command-frame';

const result = await command.getCustomTableData({
    tableName: 'loyalty_points',
    query: {
        points: { $gte: 100 },
        status: 'active'
    }
});

console.log('Active customers with 100+ points:', result.data);
```

### Get Data with Pagination

Retrieve paginated results:

```typescript
import { command } from '@final-commerce/command-frame';

const pageSize = 20;
const page = 2;

const result = await command.getCustomTableData({
    tableName: 'customer_preferences',
    offset: (page - 1) * pageSize,
    limit: pageSize
});

console.log(`Page ${page} results:`, result.data);
```

### TypeScript Type Safety

Use TypeScript generics for type-safe data:

```typescript
import { command } from '@final-commerce/command-frame';

interface CustomerPreference {
    _id: string;
    customerId: string;
    theme: 'light' | 'dark';
    notifications: boolean;
    createdAt: string;
    updatedAt: string;
}

const result = await command.getCustomTableData<CustomerPreference>({
    tableName: 'customer_preferences',
    query: { theme: 'dark' }
});

// result.data is now typed as CustomerPreference[]
result.data.forEach(pref => {
    console.log(`Customer ${pref.customerId} prefers ${pref.theme} theme`);
});
```

## Error Handling

If the data retrieval fails, the handler will throw an error. Common error scenarios include:
- Invalid `tableName` (table does not exist)
- Invalid query syntax
- Database connection issues

## Validation Rules

- `tableName` is required and must reference an existing custom table
- `query` must be a valid MongoDB query object if provided
- `offset` must be a non-negative number if provided
- `limit` must be a positive number if provided

## Real Data Examples

### Example Response

```json
{
  "success": true,
  "data": [
    {
      "_id": "65a1b2c3d4e5f6g7h8i9j0k3",
      "customerId": "691df9c6c478bada1fb23d55",
      "theme": "dark",
      "notifications": true,
      "language": "en",
      "createdAt": "2024-01-10T08:30:00.000Z",
      "updatedAt": "2024-01-12T14:20:00.000Z"
    },
    {
      "_id": "65a1b2c3d4e5f6g7h8i9j0k4",
      "customerId": "691df9c6c478bada1fb23d56",
      "theme": "light",
      "notifications": false,
      "language": "es",
      "createdAt": "2024-01-11T09:15:00.000Z",
      "updatedAt": "2024-01-11T09:15:00.000Z"
    }
  ],
  "timestamp": "2024-01-15T12:00:00.000Z"
}
```

### Example Request (with query)

```json
{
  "tableName": "customer_preferences",
  "query": {
    "theme": "dark",
    "notifications": true
  },
  "offset": 0,
  "limit": 10
}
```

## Notes

- Custom table data is stored in the local IndexedDB database (LokiJS)
- Data is synchronized with the central MongoDB database via station-sync
- Query syntax follows MongoDB query operators
- Use `getCustomTables` to list all available tables
- Use `getCustomTableFields` to get the field definitions for a table

